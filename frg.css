 Ah, that changes things! For Google Cloud Dataproc Jupyter notebooks, we need to modify the approach since Dataproc already has Spark configured. Here's the corrected version:

```python
from pyspark.sql import SparkSession

# No need to create a new SparkSession - use the existing one
spark = SparkSession.builder.getOrCreate()

def get_cloud_sql_connection():
    try:
        # Database connection properties
        connection_properties = {
            "user": "svc-prj-d-lumi-poc-prj-d-lumi-poc.iam",
            "driver": "org.postgresql.Driver",
            "socketFactory": "com.google.cloud.sql.postgres.SocketFactory",
            "cloudSqlInstance": "prj-d-netsec:us-central1:cloudsql-with-psc"
        }
        
        # JDBC URL
        jdbc_url = "jdbc:postgresql://prj-d-netsec:us-central1:cloudsql-with-psc/psc_test"
        
        return spark.read \
            .format("jdbc") \
            .option("url", jdbc_url) \
            .option("driver", connection_properties["driver"]) \
            .option("user", connection_properties["user"]) \
            .option("socketFactory", connection_properties["socketFactory"]) \
            .option("cloudSqlInstance", connection_properties["cloudSqlInstance"])
            
    except Exception as e:
        print(f"Error connecting to database: {str(e)}")
        return None

# Test the connection
try:
    connection = get_cloud_sql_connection()
    if connection:
        # Replace 'your_table' with an actual table name
        df = connection \
            .option("query", "SELECT * FROM your_table LIMIT 5") \
            .load()
        df.show()
except Exception as e:
    print(f"Error executing query: {str(e)}")
```

Key differences for Dataproc:
1. Remove the SparkSession builder configuration - Dataproc already has this set up
2. No need to specify additional packages as they should be pre-installed
3. The PostgreSQL driver should already be available in Dataproc

If you still get errors, try these troubleshooting steps:
1. Check if the PostgreSQL JDBC driver is available:
```python
# List available jars
!ls /usr/lib/spark/jars/postgresql*
```

2. Verify your Cloud SQL instance is accessible from the Dataproc cluster:
```python
# Test connectivity
!nc -zv prj-d-netsec:us-central1:cloudsql-with-psc 5432
```

Let me know what happens when you try this modified version!